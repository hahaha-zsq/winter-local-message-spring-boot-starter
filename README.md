# ğŸš€ Winter Local Message Spring Boot Starter

<div align="center">

![Java](https://img.shields.io/badge/Java-1.8+-orange.svg)
![Spring Boot](https://img.shields.io/badge/Spring%20Boot-2.6.11-brightgreen.svg)
![Maven](https://img.shields.io/badge/Maven-3.6+-blue.svg)
![License](https://img.shields.io/badge/License-MIT-yellow.svg)
![Version](https://img.shields.io/badge/Version-0.0.1-red.svg)

**ğŸ¯ ä¸€ä¸ªåŸºäºSpring Bootçš„æœ¬åœ°ä»»åŠ¡æ¶ˆæ¯å¯é æŠ•é€’æ¡†æ¶**

*æ”¯æŒHTTPã€RabbitMQã€Kafkaã€RocketMQå¤šç§é€šçŸ¥æ–¹å¼çš„å¯é æ¶ˆæ¯æŠ•é€’è§£å†³æ–¹æ¡ˆ*

</div>

---

## ğŸ“‹ ç›®å½•

- [âœ¨ ç‰¹æ€§](#-ç‰¹æ€§)
- [ğŸ¯ è§£å†³çš„é—®é¢˜](#-è§£å†³çš„é—®é¢˜)
- [ğŸ—ï¸ æŠ€æœ¯æ¶æ„](#ï¸-æŠ€æœ¯æ¶æ„)
- [ğŸ”§ å·¥ä½œåŸç†](#-å·¥ä½œåŸç†)
- [ğŸ“Š æµç¨‹å›¾](#-æµç¨‹å›¾)
- [ğŸš€ å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹)
- [âš™ï¸ é…ç½®è¯´æ˜](#ï¸-é…ç½®è¯´æ˜)
- [ğŸ“– ä½¿ç”¨ç¤ºä¾‹](#-ä½¿ç”¨ç¤ºä¾‹)
- [ğŸ”„ é‡è¯•æœºåˆ¶](#-é‡è¯•æœºåˆ¶)
- [ğŸ¤ è´¡çŒ®æŒ‡å—](#-è´¡çŒ®æŒ‡å—)
- [ğŸ“„ è®¸å¯è¯](#-è®¸å¯è¯)

---

## âœ¨ ç‰¹æ€§

ğŸ¯ **å¤šç§é€šçŸ¥æ–¹å¼**
- ğŸŒ HTTPæ¥å£è°ƒç”¨
- ğŸ° RabbitMQæ¶ˆæ¯é˜Ÿåˆ—
- ğŸš€ Apache Kafka
- ğŸš€ Apache RocketMQ

ğŸ”’ **å¯é æ€§ä¿è¯**
- ğŸ“ å…ˆå…¥åº“å†å‘é€ï¼Œä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±
- ğŸ”„ è‡ªåŠ¨é‡è¯•æœºåˆ¶ï¼Œæ”¯æŒå¤±è´¥é‡è¯•
- ğŸ  é—¨ç‰Œå·åˆ†ç‰‡ï¼Œæ”¯æŒæ°´å¹³æ‰©å±•
- ğŸ“Š çŠ¶æ€è·Ÿè¸ªï¼Œå®æ—¶ç›‘æ§æ¶ˆæ¯çŠ¶æ€

âš¡ **é«˜æ€§èƒ½**
- ğŸ”€ å¼‚æ­¥å¤„ç†ï¼Œä¸é˜»å¡ä¸»ä¸šåŠ¡æµç¨‹
- ğŸ¯ ç­–ç•¥æ¨¡å¼ï¼Œæ”¯æŒåŠ¨æ€æ‰©å±•é€šçŸ¥æ–¹å¼
- ğŸ§µ å¤šçº¿ç¨‹è°ƒåº¦ï¼Œæ”¯æŒå¹¶å‘å¤„ç†
- ğŸ“ˆ æ‰¹é‡å¤„ç†ï¼Œæå‡å¤„ç†æ•ˆç‡

ğŸ› ï¸ **æ˜“äºä½¿ç”¨**
- ğŸ·ï¸ æ³¨è§£é©±åŠ¨ï¼Œé›¶ä¾µå…¥é›†æˆ
- ğŸ”§ è‡ªåŠ¨é…ç½®ï¼Œå¼€ç®±å³ç”¨
- ğŸ“‹ çµæ´»é…ç½®ï¼Œæ”¯æŒå¤šä»»åŠ¡ç»„
- ğŸ¨ Spring Boot Starterï¼Œæ ‡å‡†åŒ–é›†æˆ

---

## ğŸ¯ è§£å†³çš„é—®é¢˜

### ğŸ’¼ ä¸šåŠ¡åœºæ™¯

åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬ç»å¸¸é‡åˆ°ä»¥ä¸‹é—®é¢˜ï¼š

1. **ğŸ”„ å¼‚æ­¥é€šçŸ¥å¯é æ€§**ï¼šå¦‚ä½•ä¿è¯é‡è¦ä¸šåŠ¡äº‹ä»¶çš„é€šçŸ¥ä¸ä¸¢å¤±ï¼Ÿ
2. **âš¡ æ€§èƒ½ä¸ä¸€è‡´æ€§**ï¼šå¦‚ä½•åœ¨ä¿è¯æ€§èƒ½çš„åŒæ—¶ç¡®ä¿æ¶ˆæ¯æŠ•é€’çš„å¯é æ€§ï¼Ÿ
3. **ğŸ”§ ç³»ç»Ÿè§£è€¦**ï¼šå¦‚ä½•é™ä½ä¸šåŠ¡ç³»ç»Ÿä¸æ¶ˆæ¯ä¸­é—´ä»¶çš„è€¦åˆåº¦ï¼Ÿ
4. **ğŸ“Š ç›‘æ§ä¸é‡è¯•**ï¼šå¦‚ä½•æœ‰æ•ˆç›‘æ§æ¶ˆæ¯æŠ•é€’çŠ¶æ€å¹¶å¤„ç†å¤±è´¥é‡è¯•ï¼Ÿ

### ğŸ¯ è§£å†³æ–¹æ¡ˆ

æœ¬æ¡†æ¶é‡‡ç”¨ **"å…ˆå…¥åº“å†å‘é€"** çš„å¯é æ¶ˆæ¯æŠ•é€’æ¨¡å¼ï¼š

```mermaid
graph LR
    A[ä¸šåŠ¡æ“ä½œ] --> B[ä¿å­˜æ¶ˆæ¯åˆ°æœ¬åœ°æ•°æ®åº“]
    B --> C[å‘å¸ƒSpringäº‹ä»¶]
    C --> D[å¼‚æ­¥å¤„ç†æ¶ˆæ¯]
    D --> E[è°ƒç”¨ç›®æ ‡ç³»ç»Ÿ]
    E --> F{è°ƒç”¨æˆåŠŸ?}
    F -->|æ˜¯| G[æ›´æ–°çŠ¶æ€ä¸ºæˆåŠŸ]
    F -->|å¦| H[æ ‡è®°ä¸ºå¤±è´¥ï¼Œç­‰å¾…é‡è¯•]
```

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### ğŸ“š æ ¸å¿ƒä¾èµ–

| æŠ€æœ¯æ ˆ | ç‰ˆæœ¬ | ç”¨é€” |
|--------|------|------|
| ![Spring Boot](https://img.shields.io/badge/-Spring%20Boot-6DB33F?style=flat&logo=spring&logoColor=white) | 2.6.11 | æ ¸å¿ƒæ¡†æ¶ |
| ![Spring AOP](https://img.shields.io/badge/-Spring%20AOP-6DB33F?style=flat&logo=spring&logoColor=white) | 2.6.11 | åˆ‡é¢ç¼–ç¨‹ |
| ![HuTool](https://img.shields.io/badge/-HuTool-FF6B35?style=flat) | 5.8.25 | å·¥å…·åº“ |
| ![Lombok](https://img.shields.io/badge/-Lombok-BC4521?style=flat&logo=lombok&logoColor=white) | 1.18.30 | ä»£ç ç®€åŒ– |
| ![RocketMQ](https://img.shields.io/badge/-RocketMQ-D77310?style=flat) | 2.3.0 | æ¶ˆæ¯é˜Ÿåˆ— |
| ![Kafka](https://img.shields.io/badge/-Kafka-231F20?style=flat&logo=apache-kafka&logoColor=white) | 2.8.11 | æ¶ˆæ¯é˜Ÿåˆ— |
| ![RabbitMQ](https://img.shields.io/badge/-RabbitMQ-FF6600?style=flat&logo=rabbitmq&logoColor=white) | 2.6.11 | æ¶ˆæ¯é˜Ÿåˆ— |

### ğŸ›ï¸ æ¶æ„è®¾è®¡

```mermaid
graph TB
    subgraph "åº”ç”¨å±‚"
        A[ä¸šåŠ¡æ–¹æ³• @LocalTaskMessage]
        B[LocalTaskMessageSender]
    end
    
    subgraph "æ¡†æ¶å±‚"
        C[LocalTaskMessageAop]
        D[LocalTaskMessageTemplate]
        E[TaskMessageEventListener]
    end
    
    subgraph "ç­–ç•¥å±‚"
        F[LocalTaskMessageNotifyFactory]
        G[HTTPNotifyStrategy]
        H[RabbitMQNotifyStrategy]
        I[KafkaNotifyStrategy]
        J[RocketMQNotifyStrategy]
    end
    
    subgraph "æ•°æ®å±‚"
        K[TaskMessageDao]
        L[(local_task_message)]
    end
    
    subgraph "è°ƒåº¦å±‚"
        M[TaskMessageEventJob]
        N[ThreadPoolTaskScheduler]
    end
    
    A --> C
    B --> D
    C --> D
    D --> E
    E --> F
    F --> G
    F --> H
    F --> I
    F --> J
    D --> K
    K --> L
    M --> F
    N --> M
    
    style A fill:#e1f5fe
    style F fill:#f3e5f5
    style L fill:#e8f5e8
```

---

## ğŸ”§ å·¥ä½œåŸç†

### ğŸ¯ æ ¸å¿ƒæµç¨‹

1. **ğŸ“ æ³¨è§£æ‹¦æˆª**ï¼šAOPåˆ‡é¢æ‹¦æˆªå¸¦æœ‰`@LocalTaskMessage`æ³¨è§£çš„æ–¹æ³•
2. **ğŸ’¾ æ¶ˆæ¯å…¥åº“**ï¼šå°†ä»»åŠ¡æ¶ˆæ¯ä¿å­˜åˆ°æœ¬åœ°æ•°æ®åº“ï¼Œç¡®ä¿æŒä¹…åŒ–
3. **ğŸ“¢ äº‹ä»¶å‘å¸ƒ**ï¼šå‘å¸ƒSpringäº‹ä»¶ï¼Œè§¦å‘å¼‚æ­¥å¤„ç†
4. **ğŸ”„ å¼‚æ­¥å¤„ç†**ï¼šäº‹ä»¶ç›‘å¬å™¨å¼‚æ­¥å¤„ç†æ¶ˆæ¯é€šçŸ¥
5. **ğŸ“Š çŠ¶æ€æ›´æ–°**ï¼šæ ¹æ®å¤„ç†ç»“æœæ›´æ–°æ¶ˆæ¯çŠ¶æ€
6. **â° å®šæ—¶é‡è¯•**ï¼šå®šæ—¶ä»»åŠ¡æ‰«æå¤±è´¥æ¶ˆæ¯è¿›è¡Œé‡è¯•

### ğŸ  åˆ†ç‰‡ç­–ç•¥

é‡‡ç”¨**é—¨ç‰Œå·ï¼ˆhouseNumberï¼‰**è¿›è¡Œæ•°æ®åˆ†ç‰‡ï¼š

```java
// é—¨ç‰Œå·è®¡ç®—è§„åˆ™
int houseNumber = Math.abs(taskId.hashCode()) % 100;
```

æ”¯æŒé…ç½®å¤šä¸ªä»»åŠ¡ç»„ï¼Œæ¯ä¸ªç»„è´Ÿè´£ä¸åŒçš„é—¨ç‰Œå·èŒƒå›´ï¼Œå®ç°æ°´å¹³æ‰©å±•ã€‚

---

## ğŸ“Š æµç¨‹å›¾

### ğŸ”„ æ¶ˆæ¯å¤„ç†æ—¶åºå›¾

```mermaid
sequenceDiagram
    participant Client as å®¢æˆ·ç«¯
    participant AOP as LocalTaskMessageAop
    participant Template as LocalTaskMessageTemplate
    participant DB as æ•°æ®åº“
    participant Event as Springäº‹ä»¶
    participant Listener as TaskMessageEventListener
    participant Strategy as é€šçŸ¥ç­–ç•¥
    participant Target as ç›®æ ‡ç³»ç»Ÿ
    
    Client->>AOP: è°ƒç”¨ä¸šåŠ¡æ–¹æ³•
    AOP->>Template: æå–TaskMessageEntityCommand
    Template->>DB: ä¿å­˜ä»»åŠ¡æ¶ˆæ¯
    DB-->>Template: ä¿å­˜æˆåŠŸ
    Template->>Event: å‘å¸ƒSpringTaskMessageEvent
    Event->>Listener: å¼‚æ­¥å¤„ç†äº‹ä»¶
    Listener->>Strategy: æ ¹æ®ç±»å‹é€‰æ‹©ç­–ç•¥
    Strategy->>Target: å‘é€é€šçŸ¥
    Target-->>Strategy: è¿”å›ç»“æœ
    Strategy->>DB: æ›´æ–°æ¶ˆæ¯çŠ¶æ€
    AOP-->>Client: è¿”å›ä¸šåŠ¡ç»“æœ
```

### ğŸ”„ é‡è¯•æœºåˆ¶æµç¨‹å›¾

```mermaid
flowchart TD
    A[å®šæ—¶ä»»åŠ¡å¯åŠ¨] --> B[æ‰«æå¤±è´¥æ¶ˆæ¯]
    B --> C{æœ‰å¾…å¤„ç†æ¶ˆæ¯?}
    C -->|å¦| D[ç­‰å¾…ä¸‹æ¬¡è°ƒåº¦]
    C -->|æ˜¯| E[æ‰¹é‡è·å–æ¶ˆæ¯]
    E --> F[éå†å¤„ç†æ¶ˆæ¯]
    F --> G[é€‰æ‹©é€šçŸ¥ç­–ç•¥]
    G --> H[æ‰§è¡Œé€šçŸ¥]
    H --> I{é€šçŸ¥æˆåŠŸ?}
    I -->|æ˜¯| J[æ›´æ–°çŠ¶æ€ä¸ºæˆåŠŸ]
    I -->|å¦| K[ä¿æŒå¤±è´¥çŠ¶æ€]
    J --> L{è¿˜æœ‰æ›´å¤šæ¶ˆæ¯?}
    K --> L
    L -->|æ˜¯| F
    L -->|å¦| D
    
    style A fill:#e3f2fd
    style I fill:#fff3e0
    style J fill:#e8f5e8
    style K fill:#ffebee
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ğŸ“¦ 1. æ·»åŠ ä¾èµ–

```xml
<dependency>
    <groupId>com.zsq</groupId>
    <artifactId>winter-local-message-spring-boot-starter</artifactId>
    <version>0.0.1</version>
</dependency>
```

### ğŸ—„ï¸ 2. åˆ›å»ºæ•°æ®è¡¨

```sql
CREATE TABLE `local_task_message` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'è‡ªå¢ä¸»é”®',
  `task_id` varchar(64) NOT NULL COMMENT 'ä»»åŠ¡ID',
  `task_name` varchar(128) NOT NULL COMMENT 'ä»»åŠ¡åç§°',
  `notify_type` varchar(32) NOT NULL COMMENT 'é€šçŸ¥ç±»å‹',
  `notify_config` text NOT NULL COMMENT 'é€šçŸ¥é…ç½®JSON',
  `status` tinyint NOT NULL DEFAULT '0' COMMENT 'çŠ¶æ€ 0-å¾…å¤„ç† 1-å¤„ç†ä¸­ 2-å·²å®Œæˆ 3-å¤±è´¥',
  `parameter_json` text COMMENT 'ä¸šåŠ¡å‚æ•°JSON',
  `house_number` int NOT NULL COMMENT 'é—¨ç‰Œå·',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_task_id` (`task_id`),
  KEY `idx_house_number_status` (`house_number`, `status`),
  KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æœ¬åœ°ä»»åŠ¡æ¶ˆæ¯è¡¨';
```

### âš™ï¸ 3. é…ç½®æ–‡ä»¶

```yaml
# application.yml
winter-local-task-message:
  groups:
    - group-id: "order-group"           # è®¢å•ç›¸å…³ä»»åŠ¡ç»„
      house-numbers: [0, 1, 2, 3, 4]   # è´Ÿè´£é—¨ç‰Œå· 0-4
      cron: "0/10 * * * * ?"            # æ¯10ç§’æ‰§è¡Œä¸€æ¬¡
      limit: 50                         # æ¯æ¬¡å¤„ç†50æ¡æ¶ˆæ¯
    - group-id: "payment-group"         # æ”¯ä»˜ç›¸å…³ä»»åŠ¡ç»„  
      house-numbers: [5, 6, 7, 8, 9]   # è´Ÿè´£é—¨ç‰Œå· 5-9
      fixed-delay-ms: 5000              # å›ºå®šå»¶è¿Ÿ5ç§’
      limit: 100                        # æ¯æ¬¡å¤„ç†100æ¡æ¶ˆæ¯
```

---

## âš™ï¸ é…ç½®è¯´æ˜

### ğŸ“‹ é…ç½®å‚æ•°è¯¦è§£

| å‚æ•° | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|------|--------|------|
| `group-id` | String | å¦ | "default" | ä»»åŠ¡ç»„æ ‡è¯†ï¼Œç”¨äºæ—¥å¿—åŒºåˆ† |
| `house-numbers` | List<Integer> | æ˜¯ | [] | è´Ÿè´£çš„é—¨ç‰Œå·åˆ—è¡¨ |
| `cron` | String | å¦ | - | Cronè¡¨è¾¾å¼ï¼Œä¸fixed-delay-msäºŒé€‰ä¸€ |
| `fixed-delay-ms` | Long | å¦ | - | å›ºå®šå»¶è¿Ÿæ¯«ç§’æ•° |
| `limit` | Integer | å¦ | 100 | æ¯æ¬¡æ‰¹é‡å¤„ç†çš„æ¶ˆæ¯æ•°é‡ |

### ğŸ¯ é—¨ç‰Œå·åˆ†é…ç­–ç•¥

```java
// æ¨èæŒ‰ä¸šåŠ¡æ¨¡å—åˆ†é…é—¨ç‰Œå·
- è®¢å•æ¨¡å—ï¼š0-19
- æ”¯ä»˜æ¨¡å—ï¼š20-39  
- ç”¨æˆ·æ¨¡å—ï¼š40-59
- å•†å“æ¨¡å—ï¼š60-79
- å…¶ä»–æ¨¡å—ï¼š80-99
```

---

## ğŸ“– ä½¿ç”¨ç¤ºä¾‹

### ğŸ·ï¸ 1. æ³¨è§£æ–¹å¼ä½¿ç”¨

```java
@Service
public class OrderService {
    
    /**
     * è®¢å•æ”¯ä»˜æˆåŠŸåå‘é€é€šçŸ¥
     */
    @LocalTaskMessage
    @Transactional
    public void processPaymentSuccess(TaskMessageEntityCommand notifyCommand) {
        // 1. æ›´æ–°è®¢å•çŠ¶æ€
        orderRepository.updateStatus(orderId, OrderStatus.PAID);
        
        // 2. æ¡†æ¶è‡ªåŠ¨å¤„ç†æ¶ˆæ¯é€šçŸ¥ï¼ˆnotifyCommandä¼šè¢«è‡ªåŠ¨æå–å¹¶å¤„ç†ï¼‰
        log.info("è®¢å•æ”¯ä»˜æˆåŠŸï¼Œå‡†å¤‡å‘é€é€šçŸ¥");
    }
    
    /**
     * æŒ‡å®šå‚æ•°åçš„æ–¹å¼
     */
    @LocalTaskMessage(entityAttributeName = "command")
    @Transactional  
    public void processOrderCancel(TaskMessageEntityCommand command, String orderId) {
        // ä¸šåŠ¡é€»è¾‘
        orderRepository.updateStatus(orderId, OrderStatus.CANCELLED);
    }
    
    /**
     * ä»å¤æ‚å¯¹è±¡ä¸­æå–å‘½ä»¤
     */
    @LocalTaskMessage(entityAttributeName = "request.notifyCommand")
    @Transactional
    public void processComplexOrder(OrderProcessRequest request) {
        // ä¸šåŠ¡é€»è¾‘
        // request.getNotifyCommand() ä¼šè¢«è‡ªåŠ¨æå–
    }
}
```

### ğŸ“¤ 2. ç¼–ç¨‹æ–¹å¼å‘é€
```yaml
server:
  port: 8091

# æ•°æ®åº“é…ç½®ï¼›å¯åŠ¨æ—¶é…ç½®æ•°æ®åº“èµ„æºä¿¡æ¯
spring:
  datasource:
    username: root
    password: root
    url: jdbc:mysql://127.0.0.1:3306/test?useUnicode=true&characterEncoding=utf8&autoReconnect=true&zeroDateTimeBehavior=convertToNull&serverTimezone=Asia/Shanghai&useSSL=true&sessionVariables=sql_mode='NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES'
    driver-class-name: com.mysql.cj.jdbc.Driver
    type: com.zaxxer.hikari.HikariDataSource
    hikari:
      pool-name: Retail_HikariCP
      minimum-idle: 15 #æœ€å°ç©ºé—²è¿æ¥æ•°é‡
      idle-timeout: 180000 #ç©ºé—²è¿æ¥å­˜æ´»æœ€å¤§æ—¶é—´ï¼Œé»˜è®¤600000ï¼ˆ10åˆ†é’Ÿï¼‰
      maximum-pool-size: 25 #è¿æ¥æ± æœ€å¤§è¿æ¥æ•°ï¼Œé»˜è®¤æ˜¯10
      auto-commit: true  #æ­¤å±æ€§æ§åˆ¶ä»æ± è¿”å›çš„è¿æ¥çš„é»˜è®¤è‡ªåŠ¨æäº¤è¡Œä¸º,é»˜è®¤å€¼ï¼štrue
      max-lifetime: 1800000 #æ­¤å±æ€§æ§åˆ¶æ± ä¸­è¿æ¥çš„æœ€é•¿ç”Ÿå‘½å‘¨æœŸï¼Œå€¼0è¡¨ç¤ºæ— é™ç”Ÿå‘½å‘¨æœŸï¼Œé»˜è®¤1800000å³30åˆ†é’Ÿ
      connection-timeout: 30000 #æ•°æ®åº“è¿æ¥è¶…æ—¶æ—¶é—´,é»˜è®¤30ç§’ï¼Œå³30000
      connection-test-query: SELECT 1
  # RabbitMQ
#  rabbitmq:
#    addresses: 127.0.0.1
#    port: 15672
#    username: admin
#    password: YourSecurePassword123!
#    listener:
#      simple:
#        prefetch: 1 # æ¯æ¬¡æŠ•é€’nä¸ªæ¶ˆæ¯ï¼Œæ¶ˆè´¹å®Œåœ¨æŠ•é€’nä¸ª
#    template:
#      delivery-mode: persistent # ç¡®ä¿å…¨å±€é»˜è®¤è®¾ç½®ä¸ºæŒä¹…åŒ–ï¼ˆå¯é€‰ï¼‰
#    # æ¶ˆæ¯é…ç½®
#    config:
#      # ç”Ÿäº§è€…
#      producer:
#        # ç»‘å®šäº¤æ¢æœºï¼Œç»Ÿä¸€ä¸€å¥—äº¤æ¢æœº
#        exchange: ltm_test_exchange
#        # æ¶ˆæ¯ä¸»é¢˜é…ç½®ï¼›è·¯ç”±keyã€é˜Ÿåˆ—
#        topic_order_success:
#          # æ¶ˆæ¯ä¸»é¢˜
#          routing_key: topic.order_success
#          # æ¶ˆè´¹é˜Ÿåˆ—
#          queue: ltm_test_queue_2_order_success
rocketmq:
  name-server: 127.0.0.1:9876   # NameServer åœ°å€ï¼ˆå¤šä¸ªç”¨åˆ†å·éš”å¼€ï¼Œå¦‚ï¼šip1:port;ip2:portï¼‰
  producer:
    group: my-producer-group     # ç”Ÿäº§è€…ç»„åï¼ˆå¿…é¡»é…ç½®ï¼‰
    # å¯é€‰é…ç½®
    send-message-timeout: 3000   # å‘é€è¶…æ—¶ï¼ˆæ¯«ç§’ï¼‰
    retry-times-when-send-failed: 2
  consumer:
    # æ¶ˆè´¹è€…é…ç½®
    pull-batch-size: 10
    enable-msg-trace: true
    customized-trace-topic: RMQ_SYS_TRACE_TOPIC
# MyBatis é…ç½®ã€å¦‚éœ€ä½¿ç”¨è®°å¾—æ‰“å¼€ã€‘
mybatis:
  mapper-locations: classpath:/mybatis/mapper/*.xml
  config-location:  classpath:/mybatis/config/mybatis-config.xml


logging:
  level:
    root: info
  config: classpath:logback-spring.xml
winter-local-task-message:
  groups:
    # ä½¿ç”¨ cron è¡¨è¾¾å¼è°ƒåº¦ï¼ˆæ¯ 10 ç§’æ‰§è¡Œä¸€æ¬¡ï¼‰
    - groupId: group01
      houseNumbers: [ 0, 1, 2, 3 ]
      cron: "0/10 * * * * ?"
      limit: 100
    # ä½¿ç”¨å›ºå®šå»¶è¿Ÿè°ƒåº¦ï¼ˆæ¯ 5 ç§’æ‰§è¡Œä¸€æ¬¡ï¼‰
    - groupId: group02
      houseNumbers: [ 4, 5, 6, 7, 8, 9 ]
      fixedDelayMs: 5000
      limit: 50
```
æ¨¡æ‹Ÿæµ‹è¯•å‘é€æ¶ˆæ¯ç±»
```java
package cn.bugstack.wrench.local.task.message.test.notify;


import com.zsq.winter.local.message.LocalTaskMessageTemplate;
import com.zsq.winter.local.message.entity.TaskMessageEntityCommand;
import com.zsq.winter.local.message.enums.TaskNotifyEnum;
import lombok.extern.slf4j.Slf4j;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.junit4.SpringRunner;

import javax.annotation.Resource;
import java.util.concurrent.CountDownLatch;

@Slf4j
@RunWith(SpringRunner.class)
@SpringBootTest
public class Notify2RocketMQTest {

  @Resource
  private LocalTaskMessageTemplate handleService;

  @Test
  public void test() throws InterruptedException {
    // å‡†å¤‡æµ‹è¯•æ•°æ®
    String topic = "test-topic";
    String tag = "test-tag";
    String key = "test-key";

    TaskMessageEntityCommand command1 = new TaskMessageEntityCommand();
    command1.setTaskId("TASK_NEW_25111502");
    command1.setTaskName("gptè°ƒç”¨æµ‹è¯•ä»»åŠ¡");
    command1.setNotifyType(TaskNotifyEnum.ROCKET_MQ.getCode());
    command1.setNotifyConfig(
            TaskMessageEntityCommand.NotifyConfig.builder()
                    .rocketMQ(TaskMessageEntityCommand.NotifyConfig.RocketMQ.builder()
                            .topic(topic)
                            .tag(tag)
                            .key(key)
                            .build())
                    .build());
    command1.setStatus(0);
    command1.setParameterJson("{\"model\": \"gpt-4o\", \"messages\": [{\"role\": \"user\", \"content\": \"1+1\"}]}");

    handleService.acceptTaskMessage(command1);

    new CountDownLatch(1).await();
  }

}

```

æ¨¡æ‹Ÿrocketmqä¸‹æ¸¸ç›‘å¬æ¶ˆæ¯ç±»
```java
package cn.bugstack.wrench.local.task.message.trigger.listener;

import com.alibaba.fastjson.JSON;
import com.zsq.winter.local.message.entity.TaskMessageEntityCommand;
import lombok.extern.slf4j.Slf4j;
import org.apache.rocketmq.spring.annotation.RocketMQMessageListener;
import org.apache.rocketmq.spring.core.RocketMQListener;
import org.springframework.stereotype.Component;

/**
 * RocketMQ æ¶ˆè´¹è€…ï¼šå¤„ç†å­—ç¬¦ä¸²æ¶ˆæ¯å¹¶è§£æä¸º TaskMessageEntityCommand
 */
@Slf4j
@Component
@RocketMQMessageListener(
        topic = "test-topic",
        consumerGroup = "task-message-consumer-group", // è‡ªå®šä¹‰æ¶ˆè´¹è€…ç»„åï¼Œå…¨å±€å”¯ä¸€
        selectorExpression = "test-tag" // åªæ¶ˆè´¹ tag = "test-tag" çš„æ¶ˆæ¯ï¼ˆå¯é€‰ï¼‰
)
public class TaskMessageConsumer implements RocketMQListener<String> {

    @Override
    public void onMessage(String messageJson) {
        try {
            log.info("ğŸš€ æ”¶åˆ°åŸå§‹æ¶ˆæ¯å­—ç¬¦ä¸²: {}", messageJson);
            
            if (messageJson == null || messageJson.trim().isEmpty()) {
                log.error("âŒ æ”¶åˆ°çš„æ¶ˆæ¯ä¸ºç©ºï¼");
                return;
            }

            // è¿™é‡Œæ”¶åˆ°çš„å®é™…ä¸Šæ˜¯ parameterJsonï¼Œéœ€è¦æ ¹æ®ä¸šåŠ¡é€»è¾‘å¤„ç†
            log.info("ï¿½ å‚æ•° Jæ¶ˆSON å†…å®¹: {}", messageJson);

            // æ ¹æ®æ¶ˆæ¯å†…å®¹æ‰§è¡Œä¸šåŠ¡é€»è¾‘
            processMessage(messageJson);

        } catch (Exception e) {
            // âš ï¸ æ³¨æ„ï¼šå¦‚æœæŠ›å‡ºå¼‚å¸¸ï¼Œæ¶ˆæ¯ä¼šé‡è¯•ï¼ˆå–å†³äºé‡è¯•ç­–ç•¥ï¼‰
            log.error("âŒ æ¶ˆè´¹æ¶ˆæ¯å¤±è´¥: {}", e.getMessage(), e);
            // æ ¹æ®ä¸šåŠ¡å†³å®šæ˜¯å¦ rethrow
            // throw new RuntimeException(e);
        }
    }

    /**
     * å¤„ç†æ¶ˆæ¯ä¸šåŠ¡é€»è¾‘
     * @param parameterJson å‚æ•°JSONå­—ç¬¦ä¸²
     */
    private void processMessage(String parameterJson) {
        try {
            // è§£æå‚æ•°JSON
            Object params = JSON.parse(parameterJson);
            log.info("âœ… æˆåŠŸè§£æå‚æ•°: {}", params);

            // TODO: åœ¨è¿™é‡Œæ‰§è¡Œä½ çš„ä¸šåŠ¡é€»è¾‘
            // ä¾‹å¦‚ï¼šè°ƒç”¨ GPTã€ä¿å­˜æ•°æ®åº“ã€è§¦å‘ä¸‹æ¸¸æœåŠ¡ç­‰
            
            // ç¤ºä¾‹ï¼šå¦‚æœæ˜¯GPTè°ƒç”¨å‚æ•°
            if (parameterJson.contains("gpt-4o")) {
                log.info("ğŸ¤– æ£€æµ‹åˆ°GPTè°ƒç”¨è¯·æ±‚ï¼Œå¼€å§‹å¤„ç†...");
                // è¿™é‡Œå¯ä»¥è°ƒç”¨GPT API
            }

            log.info("âœ… æ¶ˆæ¯å¤„ç†å®Œæˆ");

        } catch (Exception e) {
            log.error("âŒ å¤„ç†æ¶ˆæ¯ä¸šåŠ¡é€»è¾‘å¤±è´¥: {}", e.getMessage(), e);
            throw e;
        }
    }
}
```


---

## ğŸ”„ é‡è¯•æœºåˆ¶

### âš™ï¸ é‡è¯•ç­–ç•¥

- **ğŸ”„ è‡ªåŠ¨é‡è¯•**ï¼šå®šæ—¶ä»»åŠ¡è‡ªåŠ¨æ‰«æå¤±è´¥æ¶ˆæ¯è¿›è¡Œé‡è¯•
- **ğŸ“Š çŠ¶æ€ç®¡ç†**ï¼š
  - `0` - å¾…å¤„ç†
  - `1` - å¤„ç†ä¸­  
  - `2` - å·²å®Œæˆ
  - `3` - å¤±è´¥ï¼ˆç­‰å¾…é‡è¯•ï¼‰
- **ğŸ¯ æ™ºèƒ½è°ƒåº¦**ï¼šæ”¯æŒå¤šä»»åŠ¡ç»„å¹¶è¡Œå¤„ç†ä¸åŒé—¨ç‰Œå·èŒƒå›´
- **ğŸ“ˆ æ‰¹é‡å¤„ç†**ï¼šæ¯æ¬¡æ‰¹é‡è·å–æ¶ˆæ¯ï¼Œæå‡å¤„ç†æ•ˆç‡

### ğŸ“Š ç›‘æ§å»ºè®®

```sql
-- æŸ¥çœ‹æ¶ˆæ¯å¤„ç†ç»Ÿè®¡
SELECT 
    notify_type,
    status,
    COUNT(*) as count,
    DATE(create_time) as date
FROM local_task_message 
WHERE create_time >= DATE_SUB(NOW(), INTERVAL 7 DAY)
GROUP BY notify_type, status, DATE(create_time)
ORDER BY date DESC;

-- æŸ¥çœ‹å¤±è´¥æ¶ˆæ¯
SELECT * FROM local_task_message 
WHERE status = 3 
ORDER BY create_time DESC 
LIMIT 10;
```

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿æ‰€æœ‰å½¢å¼çš„è´¡çŒ®ï¼ğŸ‰

### ğŸ”§ å¼€å‘ç¯å¢ƒ

- â˜• JDK 1.8+
- ğŸ“¦ Maven 3.6+
- ğŸƒ Spring Boot 2.6+
- ğŸ—„ï¸ MySQL 5.7+

### ğŸ“ æäº¤è§„èŒƒ

```bash
# åŠŸèƒ½å¼€å‘
git commit -m "feat: æ·»åŠ é‚®ä»¶é€šçŸ¥ç­–ç•¥"

# Bugä¿®å¤  
git commit -m "fix: ä¿®å¤é‡è¯•æœºåˆ¶çš„å¹¶å‘é—®é¢˜"

# æ–‡æ¡£æ›´æ–°
git commit -m "docs: æ›´æ–°ä½¿ç”¨ç¤ºä¾‹"
```

### ğŸš€ å‘å¸ƒæµç¨‹

1. ğŸ´ Fork é¡¹ç›®
2. ğŸŒ¿ åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. ğŸ’¾ æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. ğŸ“¤ æ¨é€åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. ğŸ”„ åˆ›å»º Pull Request

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

---

<div align="center">

**â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™æˆ‘ä»¬ä¸€ä¸ªæ˜Ÿæ ‡ï¼**

Made with â¤ï¸ by [zsq](https://github.com/hahaha-zsq)

</div>